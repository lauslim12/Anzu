<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Automation Setup | Anzu</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/Anzu/favicon.ico">
    <link rel="manifest" href="/Anzu/manifest.json">
    <link rel="apple-touch-icon" href="/Anzu/icons/robot-face-icon-512.png">
    <meta name="description" content="Anzu, the Open-Source LINE Bot Documentation">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/Anzu/assets/css/0.styles.cb1be27b.css" as="style"><link rel="preload" href="/Anzu/assets/js/app.84f7b947.js" as="script"><link rel="preload" href="/Anzu/assets/js/2.00c218b4.js" as="script"><link rel="preload" href="/Anzu/assets/js/12.57f76a17.js" as="script"><link rel="preload" href="/Anzu/assets/js/3.7ffcbd81.js" as="script"><link rel="prefetch" href="/Anzu/assets/js/10.d0bfff2e.js"><link rel="prefetch" href="/Anzu/assets/js/11.f9954adf.js"><link rel="prefetch" href="/Anzu/assets/js/13.3833582b.js"><link rel="prefetch" href="/Anzu/assets/js/14.e699344f.js"><link rel="prefetch" href="/Anzu/assets/js/15.207a43e9.js"><link rel="prefetch" href="/Anzu/assets/js/16.1aa404c0.js"><link rel="prefetch" href="/Anzu/assets/js/17.195c3886.js"><link rel="prefetch" href="/Anzu/assets/js/18.f5583cf0.js"><link rel="prefetch" href="/Anzu/assets/js/19.135318ca.js"><link rel="prefetch" href="/Anzu/assets/js/20.deb2067e.js"><link rel="prefetch" href="/Anzu/assets/js/21.a18a6101.js"><link rel="prefetch" href="/Anzu/assets/js/22.20071825.js"><link rel="prefetch" href="/Anzu/assets/js/23.e16f65ee.js"><link rel="prefetch" href="/Anzu/assets/js/24.e0306779.js"><link rel="prefetch" href="/Anzu/assets/js/25.9cedbf6e.js"><link rel="prefetch" href="/Anzu/assets/js/4.94adcb92.js"><link rel="prefetch" href="/Anzu/assets/js/5.d36d972d.js"><link rel="prefetch" href="/Anzu/assets/js/6.725f8c42.js"><link rel="prefetch" href="/Anzu/assets/js/7.777fee2e.js"><link rel="prefetch" href="/Anzu/assets/js/8.0618f2cb.js"><link rel="prefetch" href="/Anzu/assets/js/9.4722cd9f.js">
    <link rel="stylesheet" href="/Anzu/assets/css/0.styles.cb1be27b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Anzu/" class="home-link router-link-active"><!----> <span class="site-name">Anzu</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Anzu/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/Anzu/getting-started.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/Anzu/commands.html" class="nav-link">
  Commands
</a></div><div class="nav-item"><a href="/Anzu/automation.html" class="nav-link">
  Automation
</a></div><div class="nav-item"><a href="/Anzu/contribution.html" class="nav-link">
  Contribution
</a></div> <a href="https://github.com/lauslim12/Anzu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Anzu/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/Anzu/getting-started.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/Anzu/commands.html" class="nav-link">
  Commands
</a></div><div class="nav-item"><a href="/Anzu/automation.html" class="nav-link">
  Automation
</a></div><div class="nav-item"><a href="/Anzu/contribution.html" class="nav-link">
  Contribution
</a></div> <a href="https://github.com/lauslim12/Anzu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anzu/" aria-current="page" class="sidebar-link">Anzu</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anzu/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/Anzu/getting-started/requirements.html" class="sidebar-link">Requirements</a></li><li><a href="/Anzu/getting-started/installation.html" class="sidebar-link">Installation</a></li><li><a href="/Anzu/getting-started/configurations.html" class="sidebar-link">Configurations</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Commands</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anzu/commands.html" class="sidebar-link">Commands</a></li><li><a href="/Anzu/commands/admin-commands.html" class="sidebar-link">Admin Commands</a></li><li><a href="/Anzu/commands/behavior-commands.html" class="sidebar-link">Behavior Commands</a></li><li><a href="/Anzu/commands/error-commands.html" class="sidebar-link">Error Handling</a></li><li><a href="/Anzu/commands/task-commands.html" class="sidebar-link">Task Commands</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Automation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anzu/automation.html" class="sidebar-link">Automation</a></li><li><a href="/Anzu/automation/setup-automation.html" aria-current="page" class="active sidebar-link">Automation Setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Anzu/automation/setup-automation.html#automation-considerations" class="sidebar-link">Automation Considerations</a></li><li class="sidebar-sub-header"><a href="/Anzu/automation/setup-automation.html#additional-configurations" class="sidebar-link">Additional Configurations</a></li><li class="sidebar-sub-header"><a href="/Anzu/automation/setup-automation.html#example-of-reminders" class="sidebar-link">Example Of Reminders</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Contribution</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anzu/contribution.html" class="sidebar-link">Contribution</a></li><li><a href="/Anzu/contribution/CONTRIBUTING.html" class="sidebar-link">Contributing</a></li><li><a href="/Anzu/contribution/CHANGELOG.html" class="sidebar-link">Changelog</a></li><li><a href="/Anzu/contribution/LICENSE.html" class="sidebar-link">License</a></li><li><a href="/Anzu/contribution/credits.html" class="sidebar-link">Credits</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="automation-setup"><a href="#automation-setup" class="header-anchor">#</a> Automation Setup</h1> <p>Cron is used to schedule timers of when Anzu would remind its users about tasks to be done and times of when Anzu would delete expired tasks. Cronjobs are run by default at the following times (GMT +7 time):</p> <ul><li>01:00 (to clean up expired tasks)</li> <li>17:00 (to remind a user / group / room about a task)</li></ul> <p>You can change the timezone and the number of times you want to be reminded by editing the configuration file at <code>constants/constants.ts</code>.</p> <p>If you have a paid LINE subscription, you can add more reminders. However, as I am stuck with the free version, I'll keep them at two reminders per day.</p> <p>A note to keep in mind that if there are no expired tasks (or no tasks are available), Anzu will not notify anything at 01:00 or 17:00. This is done so that the bandwith is not wasted. Another thing to note is that by default, this application uses the long reminder function for the schedulers (refer to <code>functions/scheduleFunctions.ts</code>).</p> <h2 id="automation-considerations"><a href="#automation-considerations" class="header-anchor">#</a> Automation Considerations</h2> <p>We have to take into consideration that Heroku free dynos sleep every 30 minutes when our application is not running. When our application is sleeping, the cronjobs made with <code>node-cron</code> <strong>will not run</strong>.</p> <p>In order to circumvent the above case, we are going to use cronjobs to ping the Heroku server, so that it will wake up before the cronjobs start.</p> <ul><li>You can change the time and the timezone of the cronjob by changing the code according to the cron syntax. Here is an <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer">excellent site<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that describes the cron syntax.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">crontab</span> -l
<span class="token function">crontab</span> -e
</code></pre></div><ul><li>The reason the crontab is setup like this is so that it gives Heroku time to prepare before running the cronjobs made with <code>node-cron</code>. We just need to ping the webserver (a small <code>GET</code> request) so that it wakes up.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">55</span> 00 * * * <span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token environment constant">$HOME</span>/Anzu/auto&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> ping-webserver.sh <span class="token operator">&lt;</span>link_to_webserver<span class="token operator">&gt;</span>
<span class="token number">55</span> <span class="token number">16</span> * * * <span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token environment constant">$HOME</span>/Anzu/auto&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> ping-webserver.sh <span class="token operator">&lt;</span>link_to_webserver<span class="token operator">&gt;</span>
</code></pre></div><ul><li>In order to check if our crontab had run successfully, we could use the following command.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">grep</span> CRON /var/log/syslog
</code></pre></div><h2 id="additional-configurations"><a href="#additional-configurations" class="header-anchor">#</a> Additional Configurations</h2> <ul><li>This part is optional. You might want to setup SSH into your Git, as I also have a script named <code>keep-track.sh</code> to always pull from the latest remote repository to keep my local repository updated. Don't forget to set the <code>origin</code> URL.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>
ssh-keygen -t rsa -b <span class="token number">4096</span> -C <span class="token operator">&lt;</span>your_github_email<span class="token operator">&gt;</span>
<span class="token builtin class-name">cd</span> .ssh
<span class="token function">ls</span> -a             <span class="token comment"># Check out your RSA '.pub' name.</span>
<span class="token function">cat</span> id_rsa.pub    <span class="token comment"># The default identifier is 'id_rsa'. You probably have a different identifier.</span>

<span class="token comment"># Then, configure your access keys with your GitHub configuration. After that, test your connection.</span>
<span class="token function">ssh</span> -T git@github.com
<span class="token function">git</span> remote set-url origin git+ssh://git@github.com/username/reponame.git
</code></pre></div><ul><li>You can run <code>keep-track.sh</code> by using the following cronjobs. In this example, I run the script everyday at 09:00 AM.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>00 09 * * * <span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token environment constant">$HOME</span>/Anzu/auto&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> keep-track.sh
</code></pre></div><h2 id="example-of-reminders"><a href="#example-of-reminders" class="header-anchor">#</a> Example Of Reminders</h2> <p>Below is the example of Anzu reminding someone.</p> <div class="language-text extra-class"><pre class="language-text"><code>Hello everyone! How are you?

This is an automated message from Anzu to remind you all of your schedules. Here is it:

... (your tasks)

Good luck and stay in high spirits!
</code></pre></div><p>Belos is the example of Anzu cleaning up tasks.</p> <div class="language-text extra-class"><pre class="language-text"><code>Hello everyone! Did you sleep well?

Anzu just wants to let you know that she has cleaned up several expired tasks. Here is it:

... (your expired tasks)

Thank you and good luck!
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Anzu/automation.html" class="prev">
        Automation
      </a></span> <span class="next"><a href="/Anzu/contribution.html">
        Contribution
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/Anzu/assets/js/app.84f7b947.js" defer></script><script src="/Anzu/assets/js/2.00c218b4.js" defer></script><script src="/Anzu/assets/js/12.57f76a17.js" defer></script><script src="/Anzu/assets/js/3.7ffcbd81.js" defer></script>
  </body>
</html>
